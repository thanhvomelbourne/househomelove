(function(n){var t=function(){var t=n.jQuery,i="enlarge";t.fn[i]=function(r){var o=arguments,u=t(this).data("options")||{button:!0,hoverZoomWithoutClick:!0,delay:300,flyout:{width:300,height:300},placement:"flyoutloupe",magnification:3},f,e;return typeof r!="string"&&(u=t.extend(u,r),t(this).data("options",u)),e=this.each(function(){function nt(){u.placement==="inline"?(s=ft,v=l,e.data("zoomParent",v),c=h):(s=a.find("img")[0],v=c=a,e.data("zoomParent",v))}function pt(){var n,t;a.css({width:u.flyout.width+"px",height:u.flyout.height+"px",top:"",left:"","margin-left":"","margin-top":""});n=u.placement.match(/left|right/);n&&a.css(n[0],-u.flyout.width+"px");t=u.placement.match(/loupe/);t&&a.css({"margin-left":-u.flyout.width/2+"px","margin-top":-u.flyout.height/2+"px"});a[0].className=a[0].className.replace(/enlarge_flyout\-[^$\s]+/," ");a.addClass("enlarge_flyout-"+u.placement)}function wt(){u.disabled?e.addClass("enlarge_disabled"):e.removeClass("enlarge_disabled")}function ii(){h.append('<i class="enlarge_loader"><i><\/i><\/i>')}function tt(){b=!e.data("zoomed");e.data("zoomed",b)}function k(n){if(n=n||function(){},b){if(u.disabled)return n(),!1;var i=new Image;i.className="enlarge_img-loading";i.onload=function(){s.sizes=i.sizes;rt&&g||(s.src=at);t(i).remove();n()};i.sizes=kt()+"px";rt&&g?g&&(i.srcset=g):i.src=at;t(i).insertBefore(s)}else s.sizes=lt,rt||(s.src=ti),n()}function ri(){var n=c.width(),t=c.height(),i=s.offsetWidth,r=s.offsetHeight;c[0].scrollLeft=i/2-n/2;c[0].scrollTop=r/2-t/2}function bt(){if(e.data("lockedZoom"))l.add(v).removeClass(ot),e.data("lockedZoom",lockedZoom=!1),c.removeAttr("tabindex");else{if(u.disabled)return!1;l.add(v).addClass(ot);e.data("lockedZoom",lockedZoom=!0);c.attr("tabindex","0");c[0].focus()}}function kt(){return l[0].offsetWidth*u.magnification}function it(){if(e.data("zoomed")){if(u.disabled)return!1;u.placement==="inline"&&h.add(l).css({width:l[0].offsetWidth+"px",height:parseFloat(getComputedStyle(l[0]).height)+"px"});v.addClass(vt);t(s).css("width",kt()+"px");t(d).trigger(i+".after-zoom-in")}else v.removeClass(vt),u.placement==="inline"&&h.add(l).css({width:"",height:""}),t(s).css("width",""),t(d).trigger(i+".after-zoom-out")}function p(){if(u.disabled&&!e.data("zoomed"))return!1;tt();k(function(){bt();it();ri()})}function ui(n){(n.type==="touchstart"&&(y=!0),y&&n.type==="mouseenter"||n.type==="mouseenter"&&!y&&!w||e.data("lockedZoom")||ht)||(ht=!0,h.addClass(et),dt=setTimeout(function(){h.removeClass(et);tt();k(function(){it();st=!0;gt(n)})},u.delay))}function fi(n){h.removeClass(et);clearTimeout(dt);st=!1;u.hoverZoomWithoutClick!==!1||y||(w=!1);y&&n.type==="mouseleave"&&(y=!1)}function gt(n){var t,i,r,f,o,l;if(st){if(y&&n.type==="mousemove")return;t=n.originalEvent||n;i=t.touches?t.touches[0]:t;n.preventDefault();r=i.clientX-h[0].getBoundingClientRect().left;f=i.clientY-h[0].getBoundingClientRect().top;u.placement.match(/loupe/)&&(o=(t.touches?-u.flyout.width/1.3:-u.flyout.width/2)+"px",l=(t.touches?-u.flyout.height/1.3:-u.flyout.height/2)+"px",requestAnimationFrame(function(){a.css({top:f+"px",left:r+"px","margin-left":o,"margin-top":l})}));var e=h[0].offsetWidth,w=h[0].offsetHeight,b=s.offsetWidth,k=s.offsetHeight,v=c[0].offsetWidth,p=c[0].offsetHeight,d=e/v,g=e/p;c[0].scrollLeft=r/e*(b-v);c[0].scrollTop=f/w*(k-p)}}var e=t(this),d=this,ct=n.document.createElement("img"),ni="srcset"in ct,rt=ni&&"sizes"in ct,ut=t(this).find("a"),ft=e.find("img")[0],s=ft,ti=s.src,g=t(s).attr("srcset"),lt=t(s).attr("sizes"),at=ut[0].href,ei=ut[0].innerText,vt=i+"-zoomed",et=i+"-delay",h=t(s).closest(".enlarge_contain"),c=h,l=t(s).closest(".enlarge_pane")||e,v=t(this).data("zoomParent")||l,b,ot,yt,st,dt,ht,y,w,a;if(t(this).data("zoomParent",v),b=e.data("zoomed")||!1,e.data("zoomed",b),e.data("lockedZoom",e.data("lockedZoom")||!1),ot=i+"-locked",!h.length)throw new Error(i+": requires an element above the image marked with the class `enlarge_contain`");if(typeof r=="string"){yt=Array.prototype.slice.call(o,1);switch(r){case"in":e.data("zoomed")||p();break;case"out":e.data("zoomed")&&p();break;case"isZoomed":f=e.data("zoomed");break;case"updateOptions":e.data("updateOptions")(yt[0])}return}wt();e.data("updateOptions",function(n){u=t.extend(u,n);t(this).data("options",u);nt();pt();w=u.hoverZoomWithoutClick;u.image&&u.image.sizes&&(lt=u.image.sizes,k());wt();u.disabled&&e.data("zoomed")&&p()});w=u.hoverZoomWithoutClick;a=t('<div class="enlarge_flyout"><\/div>').append(h.clone());a.insertAfter(l);ii();nt();pt();t(n).bind("resize",function(){e.data("lockedZoom")&&p()});t(n.document).bind("mouseup",function(n){e.data("lockedZoom")&&!t(n.target).closest(l).length&&p()});t(ft).bind("mouseenter touchstart",ui).bind("mousemove touchmove",gt).bind("mouseleave touchend",function(n){ht=!1;b&&!e.data("lockedZoom")&&(tt(),k(function(){it()}));fi(n)}).bind("click",function(n){n.preventDefault();y&&u.placement==="inline"&&p();u.hoverZoomWithoutClick!==!1||y||(w=!w,w?t(this).trigger("mouseenter"):t(this).trigger("mouseleave"))});t(this).bind("keydown keyup",function(n){n.keyCode===37||n.keyCode===38||n.keyCode===39||n.keyCode===40?(n.stopImmediatePropagation(),e.data("lockedZoom")||n.preventDefault()):n.type==="keyup"&&t(this).data("lockedZoom")&&n.keyCode===27&&(p(),ut[0].focus(),n.stopImmediatePropagation())});l.bind("scroll",function(){e.data("zoomed")&&(tt(),k(function(){e.data("lockedZoom")&&bt();it()}))})}),f!==undefined?f:e}};typeof module!="undefined"?module.exports=t:t()})(typeof global!="undefined"?global:this);